<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDTPt40Ot4iIYqkzvGBqvqfd-FAAp7JllE",
        authDomain: "james-d96f5.firebaseapp.com",
        projectId: "james-d96f5",
        storageBucket: "james-d96f5.firebasestorage.app",
        messagingSenderId: "516830675532",
        appId: "1:516830675532:web:17c66e91a7ffc7a06feae9"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;

    // Function to log in
    function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (email === "" || password === "") {
            displayError("Please fill in both fields.");
            return;
        }

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                currentUser = userCredential.user;
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('chat-container').style.display = 'block';
                document.getElementById('message').disabled = false;
                document.querySelector('button').disabled = false;
                loadMessages();
            })
            .catch((error) => {
                displayError(error.message);
            });
    }

    // Function to display login error messages
    function displayError(message) {
        const errorMessageElement = document.getElementById('error-message');
        errorMessageElement.style.display = 'block';
        errorMessageElement.textContent = message;
    }

    // Function to send a message
    function sendMessage() {
        const message = document.getElementById('message').value;
        if (message) {
            db.collection('messages').add({
                username: currentUser.email,
                message: message,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            document.getElementById('message').value = '';
        }
    }

    // Function to load messages
    function loadMessages() {
        db.collection('messages').orderBy('timestamp').onSnapshot((snapshot) => {
            const messageContainer = document.getElementById('message-container');
            messageContainer.innerHTML = '';
            snapshot.forEach((doc) => {
                const messageData = doc.data();
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(messageData.username === currentUser.email ? 'sent' : 'received');
                messageElement.textContent = `${messageData.username}: ${messageData.message}`;
                messageContainer.appendChild(messageElement);
            });
        });
    }

    // Function to log out
    function logout() {
        auth.signOut().then(() => {
            currentUser = null;
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('chat-container').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';  // Hide error message on logout
        });
    }

    // Firebase auth state change
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('chat-container').style.display = 'block';
            document.getElementById('message').disabled = false;
            document.querySelector('button').disabled = false;
            loadMessages();
        } else {
            currentUser = null;
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('chat-container').style.display = 'none';
        }
    });
</script>
